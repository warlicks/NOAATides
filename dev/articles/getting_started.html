<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting Started With noaaoceans • noaaoceans</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started With noaaoceans">
<meta property="og:description" content="noaaoceans">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">noaaoceans</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.3.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/getting_started.html">Getting Started With noaaoceans</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/warlicks/noaaoceans/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="getting_started_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting Started With noaaoceans</h1>
                        <h4 class="author">Sean Warlick</h4>
            
            <h4 class="date">2021-05-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/warlicks/noaaoceans/blob/master/vignettes/getting_started.Rmd"><code>vignettes/getting_started.Rmd</code></a></small>
      <div class="hidden name"><code>getting_started.Rmd</code></div>

    </div>

    
    
<p>The <strong>noaaoceans</strong> package is designed to facilitate access to various National Oceanic and Atmospheric Administration (NOAA) data sources. The current version focuses on accessing data from the <a href="https://api.tidesandcurrents.noaa.gov/api/prod/">CO-OPS API</a>. The package also facilitates the collection of basic metadata for each of the stations that collect the data available in the API.</p>
<p>There are two functions included in the package and they are often used together to provide the information of interest. The first function in the package is <code><a href="../reference/list_coops_stations.html">list_coops_stations()</a></code>, which allows users to find metadata about each NOAA data collection station. Each time the function is called, it gathers the data from NOAA’s website, so the station metadata and the status of its sensors is always up-to-date. The other function in the package is <code><a href="../reference/query_coops_data.html">query_coops_data()</a></code>. This function allows the user to specify a location, data type, and time period of interest. For details on the types of data available, see the <a href="https://api.tidesandcurrents.noaa.gov/api/prod/">CO-OPS API Documentation</a>.</p>
<p>In developing the <strong>noaaoceans</strong> package I have tried to make the package as user-friendly as possible. Both functions return a data frame. I feel that the typical R user is most familiar with this data structure and allows the user to immediately use the popular tools in the <strong>tideyverse</strong> to assist in their analysis. In the remainder of this article I will take the reader through an example using the package to collect and visualize water temperature data for locations in the state of Washington.</p>
<p>In the example below we start by loading the <strong>noaaoceans</strong> package and supporting packages <strong>dplyr</strong> and <strong>ggplot2</strong>. The <strong>maps</strong> and <strong>mapsdata</strong> packages will be used in the second example. Calling <code><a href="../reference/list_coops_stations.html">list_coops_stations()</a></code> returns a data frame with metadata for each of NOAA’s measurement stations.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">noaaoceans</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">maps</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mapdata</span><span class="op">)</span>

<span class="co"># Get a list of all the stations.</span>
<span class="va">station_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/list_coops_stations.html">list_coops_stations</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Inspect our data frame</span>
<span class="va">station_df</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 375  15</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">station_df</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 15
##   station_id station_names             station_state station_lat station_long
##   &lt;chr&gt;      &lt;chr&gt;                     &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;       
## 1 1611400    Nawiliwili                HI            21.9544     -159.3561   
## 2 1612340    Honolulu                  HI            21.3067     -157.867    
## 3 1612480    Mokuoloe                  HI            21.4331     -157.79     
## 4 1615680    Kahului, Kahului Harbor   HI            20.895      -156.4767   
## 5 1617433    Kawaihae                  HI            20.0366     -155.8294   
## 6 1617760    Hilo, Hilo Bay, Kuhio Bay HI            19.7303     -155.06     
## # … with 10 more variables: date_established &lt;chr&gt;, water_level &lt;chr&gt;,
## #   winds &lt;chr&gt;, air_temp &lt;chr&gt;, water_temp &lt;chr&gt;, air_pressure &lt;chr&gt;,
## #   conductivity &lt;chr&gt;, visibility &lt;chr&gt;, humidity &lt;chr&gt;, air_gap &lt;chr&gt;</code></pre>
<p>The returned data frame has a total of 15 columns. The first several columns identify the station and provide its geographic location. The remaining columns indicate the status of the of the sensors at each station. In these columns a <em>1</em> indicates the sensor is working, while a <em>0</em> indicates the sensor is not working. A <code>NA</code> indicates that that particular sensor does not exist at the given station.</p>
<p>After taking a look at the data returned by <code><a href="../reference/list_coops_stations.html">list_coops_stations()</a></code>, it’s time to identify our stations of interest. In this case I want to find all stations in the state of Washington (WA) that collect water temperature. This is accomplished by simply filtering the data frame with <code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter()</a></code> and the appropriate logic.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Filter to stations in Washington with Water Temp Sensor</span>
<span class="va">wa_station</span> <span class="op">&lt;-</span> <span class="va">station_df</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">station_state</span> <span class="op">==</span> <span class="st">'WA'</span> <span class="op">&amp;</span> <span class="va">water_temp</span> <span class="op">==</span> <span class="st">'1'</span><span class="op">)</span></code></pre></div>
<p>The results of filtering returns a data frame with records for 9 locations that meet the specified criteria. The data from the <em>station_id</em> column will be used when querying the API with <code><a href="../reference/query_coops_data.html">query_coops_data()</a></code>. Via the API we’ll capture hourly water temperatures for each station in December 2018. We’ll pass each of these conditions as an argument to the function. For a complete list of arguments see the help documentation <code><a href="../reference/query_coops_data.html">help(query_coops_data)</a></code>. The details and options available to each argument are covered in the <a href="https://api.tidesandcurrents.noaa.gov/api/prod/">CO-OPS API Documentation</a>.</p>
<p>The API only allows the user to pass a single location at time. To collect data for each station in Washington I loop through our vector of <em>station_id</em>s and update the <code>station_id =</code> argument in <code>query_coops_data</code>. Each call returns a data frame which will be concatenated to a storage data frame to create a full set of water temperature data.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create an empty storage data frame. </span>
<span class="va">water_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Loop through the station and call the API for each station</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">wa_station</span><span class="op">$</span><span class="va">station_id</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">query_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_coops_data.html">query_coops_data</a></span><span class="op">(</span>station_id <span class="op">=</span> <span class="va">i</span>,
                                 start_date <span class="op">=</span> <span class="st">'20181201'</span>,
                                 end_date <span class="op">=</span> <span class="st">'20181231'</span>,
                                 data_product <span class="op">=</span> <span class="st">'water_temperature'</span>,
                                 interval <span class="op">=</span> <span class="st">'h'</span><span class="op">)</span> <span class="co"># hourly readings</span>
    
    <span class="co"># Add current station results to the storage data frame </span>
    <span class="va">water_temp</span> <span class="op">&lt;-</span> <span class="va">water_temp</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">query_df</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">water_temp</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 6696    4</code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">water_temp</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "t"       "v"       "f"       "station"</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">water_temp</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##                  t    v     f station
## 1 2018-12-01 00:00 48.4 0,0,0 9440422
## 2 2018-12-01 01:00 48.4 0,0,0 9440422
## 3 2018-12-01 02:00 48.4 0,0,0 9440422
## 4 2018-12-01 03:00 48.4 0,0,0 9440422
## 5 2018-12-01 04:00 48.4 0,0,0 9440422
## 6 2018-12-01 05:00 48.4 0,0,0 9440422</code></pre>
<p>Now that we have our data, we’ll start by plotting the average hourly water temperature in Washington. Before I can do that I need to make a few data type corrections. Both our time stamp value (<em>t</em>) and the water temperature (<em>v</em>) are returned as character strings. These will be converted to POSIXct and numeric respectively.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Correct data types. </span>
<span class="va">water_temp</span> <span class="op">&lt;-</span> <span class="va">water_temp</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span>, t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">)</span>

<span class="va">water_temp</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="co"># Compute the hourly average. </span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>avg_temp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">v</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="co"># Plot the hourly average. </span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">avg_temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date"</span>,
         y <span class="op">=</span> <span class="st">'Average Water Temperature'</span>,
         title <span class="op">=</span> <span class="st">'Average Hourly Water Temperature In Washington During December 2018'</span><span class="op">)</span></code></pre></div>
<p><img src="getting_started_files/figure-html/plot_data-1.png" width="672"></p>
<p>As one might expect the average hourly temperature decreases over the month as winter sets in. There is a steady decrease over the first ten days, before the temperature rises again and holds fairly steady after the middle of the month. There appears to be a daily pattern where the temperature drops at night and increases during the day.</p>
<p>One consequence of finding the hourly average is that we have hidden any geographic effects. There might be temperature differences at each station. A map with each station and the average temperature at that station will help study this.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Compute the average temperature by location. </span>
<span class="va">station_average</span> <span class="op">&lt;-</span> <span class="va">water_temp</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">station</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>avg_temp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">v</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> 

<span class="co"># Join the station metadata so we have the location of each station.    </span>
<span class="va">station_average</span> <span class="op">&lt;-</span> <span class="va">station_average</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">wa_station</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'station'</span> <span class="op">=</span> <span class="st">'station_id'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="co"># Convert the station corrdinates to numeric data type to work with plot</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>station_long <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">station_long</span><span class="op">)</span>,
           station_lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">station_lat</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Inspect our data frame before plotting</span>
<span class="va">station_average</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1]  9 16</code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">station_average</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 16
##   station avg_temp station_names          station_state station_lat station_long
##   &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;                  &lt;chr&gt;               &lt;dbl&gt;        &lt;dbl&gt;
## 1 9440422     45.6 Longview               WA                   46.1        -123.
## 2 9440910     47.6 Toke Point             WA                   46.7        -124.
## 3 9441102     48.5 Westport               WA                   46.9        -124.
## 4 9442396     45.1 La Push, Quillayute R… WA                   47.9        -125.
## 5 9443090     48.6 Neah Bay               WA                   48.4        -125.
## 6 9444090     48.2 Port Angeles           WA                   48.1        -123.
## # … with 10 more variables: date_established &lt;chr&gt;, water_level &lt;chr&gt;,
## #   winds &lt;chr&gt;, air_temp &lt;chr&gt;, water_temp &lt;chr&gt;, air_pressure &lt;chr&gt;,
## #   conductivity &lt;chr&gt;, visibility &lt;chr&gt;, humidity &lt;chr&gt;, air_gap &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get a map for Washington state.</span>
<span class="va">wa_map</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html">map_data</a></span><span class="op">(</span><span class="st">'state'</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">region</span> <span class="op">==</span> <span class="st">'washington'</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wa_map</span><span class="op">)</span> <span class="op">+</span> 
  <span class="co"># Plot the map</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>,
                   y <span class="op">=</span> <span class="va">lat</span>,
                   group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>,
               fill <span class="op">=</span> <span class="st">"gray"</span>,
               color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="co"># Add the stations &amp; use color for the average temp. </span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">station_long</span>,
                 y <span class="op">=</span> <span class="va">station_lat</span>,
                 color <span class="op">=</span> <span class="va">avg_temp</span><span class="op">)</span>,
             data <span class="op">=</span> <span class="va">station_average</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Longitude'</span>,
         y <span class="op">=</span> <span class="st">'Latitude'</span>,
         title <span class="op">=</span> <span class="st">'Average Water Temperature by Station'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_continuous.html">scale_color_continuous</a></span><span class="op">(</span>name <span class="op">=</span><span class="st">"Average Water\n Temperature"</span><span class="op">)</span></code></pre></div>
<p><img src="getting_started_files/figure-html/make_map-1.png" width="576"></p>
<p>After looking at some basic examples of using <strong>noaaoceans</strong> we should highlight a known issue with the <a href="https://api.tidesandcurrents.noaa.gov/api/prod/">CO-OPS API</a>. While developing the package we encountered a few occasions where the data inventory indicates that data exist for a given time period, but it isn’t available via the API.</p>
<p>A specific example as of this this writing is the Neah Bay (Station ID: 9443090). The station’s <a href="https://tidesandcurrents.noaa.gov/inventory.html?id=9443090">data inventory</a> indicates that water temperature is available for all of 2018. However, when querying the API the data for January and February 2018 isn’t available.</p>
<p>Depending on the date requested in the API call, the API handles this problem in different ways. When setting the date range for only the missing period, the API response includes an error indicating that no data was found.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">neah_bay_january</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_coops_data.html">query_coops_data</a></span><span class="op">(</span>station_id <span class="op">=</span> <span class="st">'9443090'</span>,
                                     start_date <span class="op">=</span> <span class="st">'20180101'</span>,
                                     end_date <span class="op">=</span> <span class="st">'20180228'</span>,
                                     data_product <span class="op">=</span> <span class="st">'water_temperature'</span>,
                                     interval <span class="op">=</span> <span class="st">'h'</span><span class="op">)</span></code></pre></div>
<pre><code>## Error in query_coops_data(station_id = "9443090", start_date = "20180101", : No data was found. This product may not be offered at this station at the requested time.</code></pre>
<p>When querying the API for the Neah Bay station and request all of 2018 an error is not included in the response. The expected data frame is returned.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">neah_bay_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_coops_data.html">query_coops_data</a></span><span class="op">(</span>station_id <span class="op">=</span> <span class="st">'9443090'</span>,
                                     start_date <span class="op">=</span> <span class="st">'20180101'</span>,
                                     end_date <span class="op">=</span> <span class="st">'20181231'</span>,
                                     data_product <span class="op">=</span> <span class="st">'water_temperature'</span>,
                                     interval <span class="op">=</span> <span class="st">'h'</span><span class="op">)</span>

<span class="va">neah_bay_year</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##                  t v     f station
## 1 2018-01-01 01:00   1,1,1 9443090
## 2 2018-01-01 02:00   1,1,1 9443090
## 3 2018-01-01 03:00   1,1,1 9443090
## 4 2018-01-01 04:00   1,1,1 9443090
## 5 2018-01-01 05:00   1,1,1 9443090
## 6 2018-01-01 06:00   1,1,1 9443090</code></pre>
<p>A quick inspection of the returned data frame shows that the temperature value (<em>v</em>) is missing for the January and February time stamps. In summary if you query for a period where there is only missing data you’ll get an error. If you submit a query for a date range and a subset of that period is missing data will be returned with missing values for the appropriate dates.</p>
<p>If you encounter a situation where it appears that data should be available for a given query, you might want to contact NOAA’s User Services(<a href="mailto:co-ops.userservices@noaa.gov" class="email">co-ops.userservices@noaa.gov</a>). They have been very responsive, when issues have been raised and worked to get the missing data accessible if the data is in their database.</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="www.seanwarlick.com">Sean Warlick</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
